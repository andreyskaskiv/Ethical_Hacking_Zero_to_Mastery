import subprocess


def run_nmap(target_ip: str, target_port: str) -> list:
    """ Runs the nmap command with silent scan options and
    bypasses the firewall and returns the result as a list of strings."""

    nmap_output = subprocess.check_output(f"nmap -p {target_port} {target_ip} -sV -sT -Pn",
                                          shell=True).decode('utf-8').split('\n')
    return nmap_output


def extract_service_info(nmap_output: list, target_port: str) -> dict:
    """Extracts information about a service from the output of a nmap command and returns it as a dictionary."""

    for line in nmap_output:
        if line.startswith(target_port):
            parts = line.split()
            service_info = {
                "PORT": parts[0],
                "STATE": parts[1],
                "SERVICE": parts[2],
                "VERSION": ' '.join(parts[3:]) if len(parts) > 3 else None
            }
            return service_info
    return None


def get_service_info(target_ip: str, target_port: str) -> dict:
    """ Runs the nmap command, retrieves information about the service and returns it as a dictionary."""

    nmap_output = run_nmap(target_ip, target_port)
    service_info = extract_service_info(nmap_output, target_port)
    return service_info


if __name__ == "__main__":
    # Target IP address and port
    target_ip = "10.0.2.4"
    target_port = "21"

    service_info = get_service_info(target_ip, target_port)
    print(service_info)
